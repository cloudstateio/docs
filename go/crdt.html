<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conflict-free Replicated Data Types :: Cloudstate Documentation</title>

<link rel="stylesheet" href="../_/css/site.css?v-01">
<link rel="shortcut icon" href="../_/img/favicon.ico" />

<meta itemprop="name" content="Conflict-free Replicated Data Types | Cloudstate Documentation">
<meta name="twitter:title" content="Conflict-free Replicated Data Types | Cloudstate Documentation">
<meta property="og:title" content="Conflict-free Replicated Data Types | Cloudstate Documentation" />

<meta property="og:type" content="website" />

<meta name="generator" content="Antora 2.3.3">

<link rel="canonical" href="https://cloudstate.io/docs/go/crdt.html">
<meta property="og:url" content="https://cloudstate.io/docs/go/crdt.html" />



<meta property="og:site_name" content="Cloudstate Documentation" />
<meta name="author" content="Cloudstate Documentation">
<meta itemprop="image" content="https://cloudstate.io/dist/images/cloudstate-distributed-state-management-for-serverless.png">
<meta name="twitter:image:src" content="https://cloudstate.io/dist/images/cloudstate-distributed-state-management-for-serverless.png">
<meta property="og:image" content="https://cloudstate.io/dist/images/cloudstate-distributed-state-management-for-serverless.png" />
<meta property="og:image:secure_url" content="https://cloudstate.io/dist/images/cloudstate-distributed-state-management-for-serverless.png" />
<!--Head Scripts -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="c3a30abe-4934-45a2-ba48-823fa026fc64" ></script>
<!--Head Scripts YouTube Embed-->
<script type="text/javascript">
	var ytID;
	function OptanonWrapper() {
		//find each YouTube embed and only load if cookies have been approved
		$( "a.yt-widget" ).each(function( index ) {
			var anchor = $(this);
			var ytURL = $(this).attr("href");
			var queryString = anchor[0].search;
			let params = new URLSearchParams(queryString);
			ytID = params.get("v");
			$(this).before('<div class="flex-video-wrapper"><div class="flex-video"><div id="yt-'+ytID+'" class="cookie-warning youtube-warning"><a class="optanon-allow-all" onclick="OneTrust.AllowAll();">Accept cookies to view video</a><span>Alternatively you can watch the video <a href="'+ytURL+'" target="_blank">here on YouTube</a></span></div></div></div>');
			$(this).removeAttr("href").removeClass("yt-widget").addClass("yt-widget-hide");
		});

		$( ".youtube-warning" ).each(function( index ) {
			OneTrust.InsertHtml('<iframe id="player" class="youtube-embed-player" src="//www.youtube.com/embed/'+ytID+'?rel=0&modestbranding=0" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>', 'yt-'+ytID, null, {deleteSelectorContent: true}, '4');
		});
	}
</script>  </head>
  <body class="article  cloudstate">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://cloudstate.io">
        <img class="header-logo" src="../_/img/cloudstate-reverse.svg">
      </a>
      <a href="https://cloudstate.io/docs/" id="site-id" class="site-id">Documentation</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div id="lightbend-banner" class="lightbend-banner cloudstate full-width" data-category="OSS Lightbend Banner Impression" data-label="Cloudstate Banner Impression">
  <div class="wrapper">
    <div class="nav">
      <a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your apps with Lightbend [Button] - Cloudstate Banner" href="https://www.lightbend.com/lightbend-subscription?r=oss-banner-cloudstate" target="_blank">
        <span class="banner-btn-text">Enhance your apps with</span>
        <img class="lightbend-logo" src="../_/img/lightbend-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
      </a>
      <div class="drop-down">
        <svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
          <g>
            <circle cx="10" cy="10" r="9" />
            <path d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
            c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z" />
          </g>
        </svg>
        <div class="drop-down-content">
          <div class="lightbend-family">
            <a href="https://akka.io" class="akka oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Akka - Logo Tag Line - Cloudstate Banner">
              <img class="akka-full-color-logo" src="../_/img/lightbend-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
            </a>
            <a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Cloudstate Banner">
              <img class="cloudflow-full-color-logo" src="../_/img/lightbend-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
            </a>
            <a href="https://www.lagomframework.com" class="lagom oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lagom - Logo Tag Line - Cloudstate Banner">
              <img class="lagom-full-color-logo" src="../_/img/lightbend-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
            </a>
            <a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Cloudstate Banner">
              <img class="play-full-color-logo" src="../_/img/lightbend-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
            </a>
            <a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Cloudstate Banner">
              <img class="scala-full-color-logo" src="../_/img/lightbend-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
            </a>
            <div class="cloudstate current">
              <img class="cloudstate-full-color-logo" src="../_/img/lightbend-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
              <span>Get developer assistance and expert support from Lightbend.</span>
              <a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Cloudstate Banner" href="https://www.lightbend.com/lightbend-subscription?r=oss-banner-cloudstate" target="_blank">Learn More</a>
            </div>
          </div>
          <div class="title">The Lightbend Family</div>
        </div>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="" data-version="master">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../stateless-limitations.html">Current limitations of Serverless platforms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../crud-limitations.html">Rethinking CRUD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloudstate-solution.html">The Cloudstate solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../working.html">Working with Cloudstate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../examples.html">Example Applications</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../concepts/index.html">Important concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/grpc.html">gRPC</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/crdts.html">Conflict-free replicated data types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/effects.html">Forwarding and effects</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../develop/index.html">Developing Cloudstate services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/prerequisites.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/install.html">Installing Cloudstate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/gke.html">Run on GKE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/examples.html">Available Cloudstate examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/tutorial.html">The shopping cart tutorial</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../dart/index.html">Implementing in Dart</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dart/gettingstarted.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dart/eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dart/crdt.html">Conflict-free Replicated Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dart/actions.html">Actions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dart/examples.html">Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dart/serialization.html">Serialization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="index.html">Implementing in Go</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="gettingstarted.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="crdt.html">Conflict-free Replicated Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="effects.html">Forwarding and effects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="api.html">API docs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../java/index.html">Implementing in Java</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java/getting-started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java/eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java/crdt.html">Conflict-free Replicated Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java/effects.html">Forwarding and effects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../java/api.html">Java API docs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../javascript/index.html">Implementing in JavaScript</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javascript/getting-started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javascript/eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javascript/crdt.html">Conflict-free Replicated Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javascript/effects.html">Forwarding and effects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javascript/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../javascript/api.html">JavaScript API docs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../kotlin/index.html">Implementing in Kotlin</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/gettingstarted.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/crdt.html">Conflict-free Replicated Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../kotlin/dsl.html">DSL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kotlin/eventsourceddsl.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kotlin/crdtdsl.html">Conflict-free Replicated Data Types</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/examples.html">Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/serialization.html">Serialization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../python/index.html">Implementing in Python</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../python/gettingstarted.html">Getting started</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../springboot/index.html">Implementing in Spring Boot</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../springboot/gettingstarted.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../springboot/configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../springboot/cdi.html">Context Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../springboot/conventions.html">Conventions and Restrictions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../springboot/examples.html">Examples</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../dotnet/index.html">Implementing in .Net</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dotnet/gettingstarted.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dotnet/eventsourced.html">Event sourcing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dotnet/crdt.html">Conflict-free Replicated Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dotnet/actions.html">Actions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dotnet/examples.html">Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../dotnet/serialization.html">Serialization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../deploy/index.html">Deploying to production systems</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/install-production.html">Setting up a production cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/deploying.html">Deploying stateful services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../deploy/stateful-stores.html">Stateful stores</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../deploy/cassandra.html">Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../deploy/postgresql.html">PostgresSQL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../deploy/inmemory.html">In memory store</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/autoscaling.html">Autoscaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/security.html">Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../contribute/index.html">Contributing to the project</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/getting-started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/build-native.html">Building native images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/serialization.html">Serialization conventions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/language-support.html">Language support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/knative-integration.html">Knative integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/graalvm-integration.html">GraalVM integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contribute/testing.html">Testing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cloudstate</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Cloudstate</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Implementing in Go</a></li>
    <li class="crumb"><a href="crdt.html">Conflict-free Replicated Data Types</a></li>
  </ul>
</nav>
</div>
    <div class="col-content">
<article id="page-content" class="doc">
			<h1>Conflict-free Replicated Data Types</h1>

		<fieldset class="supergroup-switch">


		</fieldset>

		<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page documents how to implement Cloudstate CRDT entities in Go.
For information on what Cloudstate CRDT entities are, please read the general <a href="../concepts/crdts.html" class="page">Conflict-free Replicated Data Type</a> documentation first.</p>
</div>
<div class="paragraph">
<p>A CRDT entity can be created by implementing the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#EntityHandler"><code>crdt.EntityHandler</code></a> interface and registering an entity with a Cloudstate instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">type EntityHandler interface {
	HandleCommand(ctx *CommandContext, name string, msg proto.Message) (*any.Any, error)
	Default(ctx *Context) (CRDT, error)
	Set(ctx *Context, state CRDT) error
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-and-creating-an-entitys-crdt"><a class="anchor" href="#accessing-and-creating-an-entitys-crdt"></a>Accessing and creating an entity&#8217;s CRDT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each CRDT entity manages one root CRDT. That CRDT will either be supplied to the entity by the proxy when it is started through <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#EntityHandler"><code>crdt.EntityHandler.Set</code></a>, or, if no CRDT exists for the entity when it is started, it has to be created by the entity using the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#EntityHandler"><code>crdt.EntityHandler.Default</code></a> factory method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">func (s *ShoppingCart) Default(ctx *crdt.Context) (crdt.CRDT, error) {
	return crdt.NewORMap(), nil
}

func (s *ShoppingCart) Set(ctx *crdt.Context, state crdt.CRDT) error {
	s.items = state.(*crdt.ORMap)
	return nil
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The state, the CRDT, supplied with <code>Set</code> by the Cloudstate instance will never be of a different type than what <code>Default</code> returns for a CRDT entity.
This is because of their symmetric use for the same entities instance and version.
In this regard, a type assertion check is not necessary.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handling-commands"><a class="anchor" href="#handling-commands"></a>Handling commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Command handlers are implemented with the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#EntityHandler"><code>crdt.EntityHandler.HandleCommand</code></a> method.
The command handler provides a <code>CommandContext</code>, a commands <code>name</code>, and the gRPCs message as a protobuf message.
The matching combination of a commands name and the messages type from the defined gRPC service can be used to handle the command.
So to handle the shopping cart service method <code>GetCart</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">rpc GetCart (GeShoppingCart) returns (Cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>the commands name <code>GetCart</code> together with its message type <code>GetShoppingCart</code> has to be matched.
A type switch or a type assertion for the protobuf command message is useful to get the commands data, process it, and then return the appropriate return type, <code>Cart</code> in our example.</p>
</div>
<div class="paragraph">
<p>The return type of the command handler must be the output type for the gRPC service call, this will be sent as the reply.</p>
</div>
<div class="paragraph">
<p>The following shows the implementation of the <code>GetCart</code> command.
This command handler is a read-only command handler, it doesn&#8217;t update the CRDT, it just returns some state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">func (s *ShoppingCart) HandleCommand(ctx *crdt.CommandContext, name string, msg proto.Message) (*any.Any, error) {
	switch m := msg.(type) {
	case *GetShoppingCart:
		cart, err := s.getCart()
		if err != nil {
			return nil, err
		}
		return encoding.MarshalAny(cart)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-a-crdt"><a class="anchor" href="#updating-a-crdt"></a>Updating a CRDT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to Cloudstate&#8217;s <a href="../concepts/crdts.html#approach-to-crdts-in-cloudstate" class="page">take in turns approach</a>, CRDTs may only be updated in command handlers and <a href="#responding-to-stream-cancellation">stream cancellation callbacks</a>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a snipped for handling of the <code>AddLineItem</code> message that adds the item to the shopping cart.
If the gRPC service methods message identifies a service unambiguously, there is no need to dispatch the commands name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">func (s *ShoppingCart) HandleCommand(ctx *crdt.CommandContext, name string, msg proto.Message) (*any.Any, error) {
...
	switch m := msg.(type) {
	case *AddLineItem:
		if m.GetQuantity() &lt;= 0 {
			return nil, errors.New("cannot add a negative quantity of items")
		}

		item, err := encoding.MarshalAny(&amp;LineItem{
			ProductId: m.GetProductId(),
			Name:      m.GetName(),
			Quantity:  m.GetQuantity(),
		})
		if err != nil {
			return nil, err
		}
		key := encoding.String(m.GetProductId())
		reg, err := s.items.LWWRegister(key)
		if err != nil {
			return nil, err
		}
		if reg != nil {
			reg.Set(item)
		} else {
			reg = crdt.NewLWWRegister(item)
		}
		s.items.Set(key, reg)
		return encoding.Empty, nil
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s good practice to dispatch commands both using their command name and messages type.
Unfortunately, the Go gRPC implementation does not provide typesafe service descriptors out of a compiled <code>*.proto</code> file as they are not exported to be user accessible.</p>
</div>
<div class="paragraph">
<p>While the Go runtime function <code>runtime.FuncForPC</code> allows to get a function pointers pointed function name and there are ways to get the <code>shoppingcart.ShoppingCartServiceServer.AddItem</code> command name from the gRPC interface of the shopping cart service at runtime, we do not encourage doing so.
In general, the Cloudstate Go User Support library does use explicit ways to implement the gRPC service of a Cloudstate entity.
It could have been implemeted using reflection heavily, although this is non-idiomatic use of Go and would leave this library as a strange citizen in the Go ecosystem.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deleting-a-crdt"><a class="anchor" href="#deleting-a-crdt"></a>Deleting a CRDT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A CRDT can be deleted by invoking <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Context.Delete"><code>crdt.Context.Delete</code></a>.
Once a CRDT is deleted, the entity will be shut down, and all subsequent commands for the entity will be rejected.</p>
</div>
<div class="paragraph">
<p>Caution should be taken when deleting CRDTs - the Reference Implementation of the proxy needs to maintain tombstones for each CRDT deleted, so over time, if many CRDTs are created and deleted, this will result in not just running out of memory, but increased network usage as the tombstones still need to be gossipped through the cluster for replication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="streamed-command-handlers"><a class="anchor" href="#streamed-command-handlers"></a>Streamed command handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Streamed commands can be used to receive and publish updates to the state.
If a gRPC service call has a streamed result type, the handler for that call can use the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#CommandContext"><code>crdt.CommandContext</code></a>, and use that to register handler functions.</p>
</div>
<div class="sect2">
<h3 id="responding-to-changes"><a class="anchor" href="#responding-to-changes"></a>Responding to changes</h3>
<div class="paragraph">
<p>If the command handler wishes to publish changes to the stream it can register a handler function with <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#CommandContext.ChangeFunc"><code>crdt.CommandContext.ChangeFunc</code></a>, which will be invoked every time the CRDT changes.</p>
</div>
<div class="paragraph">
<p>The handler function is then able to return a message to be sent to the client (or <code>empty.Empty</code>, if it wishes to send no message in response to that particular change).
The handler function may not modify the CRDT itself, but it may emit effects that may modify the CRDT.</p>
</div>
<div class="paragraph">
<p>If the shopping cart service had a <code>WatchCart</code> call, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-protobuf hljs" data-lang="protobuf">rpc WatchCart (GetShoppingCart) returns (stream Cart);</code></pre>
</div>
</div>
<div class="paragraph">
<p>that could be implemented like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">switch name {
case "WatchCart":
	ctx.ChangeFunc(func(c *crdt.CommandContext) (*any.Any, error) {
		cart, err := s.getCart()
		if err != nil {
			return nil, err
		}
		return encoding.MarshalAny(cart)
	})
	cart, err := s.getCart()
	if err != nil {
		return nil, err
	}
	return encoding.MarshalAny(cart)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ending-the-stream"><a class="anchor" href="#ending-the-stream"></a>Ending the stream</h3>
<div class="paragraph">
<p>The <code>ChangeFunc</code> handler function can end the stream by invoking <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#CommandContext.EndStream"><code>crdt.CommandContext.EndStream</code></a> on the <code>CommandContext</code> it is passed.
If it does this, it will not receive an cancellation callback.</p>
</div>
</div>
<div class="sect2">
<h3 id="responding-to-stream-cancellation"><a class="anchor" href="#responding-to-stream-cancellation"></a>Responding to stream cancellation</h3>
<div class="paragraph">
<p>A command handler may register an <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#CommandContext.CancelFunc"><code>crdt.CommandContext.CancelFunc</code></a> handler function to be notified when the stream is cancelled.
The cancellation handler function may update the CRDT. This is useful if the CRDT is being used to track connections, for example, when using <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote"><code>crdt.Vote</code></a> CRDTs to track a user&#8217;s online status.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="types-of-crdts"><a class="anchor" href="#types-of-crdts"></a>Types of CRDTs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cloudstate Go language support library offers Go types for each of the <a href="../concepts/crdts.html#crdts-available-in-cloudstate" class="page">CRDTs available in Cloudstate</a>.</p>
</div>
<div class="sect2">
<h3 id="counters-and-flags"><a class="anchor" href="#counters-and-flags"></a>Counters and flags</h3>
<div class="paragraph">
<p><a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#GCounter"><code>crdt.GCounter</code></a>, <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#PNCounter"><code>crdt.PNCounter</code></a> and <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Flag"><code>crdt.Flag</code></a> are available, offering operations relevant to each CRDT.</p>
</div>
</div>
<div class="sect2">
<h3 id="vote"><a class="anchor" href="#vote"></a>Vote</h3>
<div class="paragraph">
<p><a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote"><code>crdt.Vote</code></a> is available for the Vote CRDT. The Vote CRDT allows updating the current node&#8217;s vote using the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.Vote"><code>crdt.Vote.Vote</code></a> method, the current nodes vote can be queried using the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.SelfVote"><code>crdt.Vote.SelfVote</code></a> method.</p>
</div>
<div class="paragraph">
<p>For determining the result of a vote, <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.Voters"><code>crdt.Vote.Voters</code></a> and for determining the result of a vote, <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.VotesFor"><code>crdt.Vote.VotesFor</code></a> can be used to check the total number of nodes, and the number of nodes that have voted for the condition, respectively.
In addition, convenience methods are provided for common vote decision approaches, <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.AtLeastOne"><code>crdt.Vote.AtLeastOne</code></a> returns true if there is at least one voter for the condition. <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.Majority"><code>crdt.Vote.Majority</code></a> returns true if the number of votes for is more than half the number of voters, and <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#Vote.All"><code>crdt.Vote.All</code></a> returns <code>true</code> if the number of votes for equals the number of voters.</p>
</div>
</div>
<div class="sect2">
<h3 id="registers"><a class="anchor" href="#registers"></a>Registers</h3>
<div class="paragraph">
<p><a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#LWWRegister"><code>crdt.LWWRegister</code></a> provides the LWWRegister CRDT. It can be interacted with using the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#LWWRegister.Set"><code>crdt.LWWRegister.Set</code></a> and <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#LWWRegister.Value"><code>crdt.LWWRegister.Value</code></a> methods.
If you wish to use a custom clock, you can use the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#LWWRegister.SetWithClock"><code>crdt.LWWRegister.SetWithClock</code></a> overload that allows passing a custom clock and custom clock value.</p>
</div>
</div>
<div class="sect2">
<h3 id="sets-and-maps"><a class="anchor" href="#sets-and-maps"></a>Sets and Maps</h3>
<div class="paragraph">
<p>The Cloudstate Go support provides <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#GSet"><code>crdt.GSet</code></a>, <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#ORSet"><code>crdt.ORSet</code></a> and <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate/crdt#ORMap"><code>crdt.ORMap</code></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With Cloudstate maps and sets, the map keys and set values serialized form must be stable.
The Cloudstate proxy uses the serialized form of the values to track changes in the set or map.
If the same value serializes to two different sets of bytes on different occasions, they will be treated as different elements in the set or map.</p>
</div>
<div class="paragraph">
<p>This is particularly relevant when using protocol buffers.
The ordering of map entries in a serialized protocol buffers is undefined, and very often will be different for two equal maps.
Hence, maps should never be used as keys in <code>ORMap</code> or as values in <code>GSet</code>, <code>ORSet</code>.
For the rest of the protocol buffers specification, while no guarantees are made on the stability by the specification itself, the Go protocol buffer libraries do <a href="https://pkg.go.dev/google.golang.org/protobuf/proto#MarshalOptions">produce stable orderings of fields and stable output of non-map values</a>.</p>
</div>
<div class="paragraph">
<p>Care should be taken when changing the structure of protocol buffers.
Many changes that are backwards compatible from a protocol buffer standpoint do not necessarily translate into stable serializations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registering-the-entity"><a class="anchor" href="#registering-the-entity"></a>Registering the entity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you&#8217;ve created your entity, you can register it with the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate#CloudState"><code>cloudstate.CloudState</code></a> server, by invoking the <a href="https://pkg.go.dev/github.com/cloudstateio/go-support/cloudstate#CloudState.RegisterCRDT"><code>cloudstate.CloudState.RegisterCRDT</code></a> method.
In addition to passing your entity and service descriptor, if you use protocol buffers for serialization and any protobuf message definitions are missing from your service descriptor (they are not declared directly in the file, nor as dependencies), then you&#8217;ll need to pass those protocol buffer descriptors as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-go hljs" data-lang="go">err = server.RegisterCRDT(&amp;crdt.Entity{
	ServiceName: "example.shoppingcart.ShoppingCartService",
	EntityFunc:  shoppingcart.NewShoppingCart,
}, protocol.DescriptorConfig{
	Service: "shoppingcart.proto",
}.AddDomainDescriptor("domain.proto", "hotitems.proto"))</code></pre>
</div>
</div>
</div>
</div>
		<nav class="pagination">
  <span class="prev"><a href="eventsourced.html">Event sourcing</a></span>
  <span class="next"><a href="effects.html">Forwarding and effects</a></span>
</nav>
</article>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
    </div>
<div class="main-footer">
  <div class="page-source">
Found an error in this documentation? Please feel free to <a href="https://github.com/cloudstateio/go-support/edit/master/docs/src/modules/go/pages/crdt.adoc">edit this page</a> and contribute a pull request.
</div>
  <div class="footer-box">
    <footer class="footer">
      <div class="footer-logo"><a href="https://cloudstate.io"><img src="../_/img/cloudstate-color.svg"></a></div>
      <div class="footer-content">© Cloudstate <script>document.write(new Date().getFullYear());</script> | <a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | <a href="https://cloudstate.io/cookie">Cookie Listing</a> | <a class="optanon-toggle-display">Cookie Settings</a></div>
    </footer>
  </div>
</div>  </main>
</div>
<!--Footer Scripts Global-->
<script src="../_/js/site.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="../_/js/vendor/groups.js"></script>
<script>hljs.initHighlighting()</script>
<script src="../_/js/vendor/jquery.waypoints.min.js"></script>
<script src="../_/js/vendor/inview.min.js"></script>

<script>
(function($) {
	$(function() {
		
		var pageViewedTriggerElement = '#page-content';
		//override #page-content if a custom trigger is present in page
		if($("#page-viewed-trigger").length){
			pageViewedTriggerElement = '#page-viewed-trigger';
		}

		var inview = new Waypoint.Inview({
			element: $(pageViewedTriggerElement)[0],
				entered: function(direction) {
				//fire custom Jquery event that Marketo can listen for
				$.event.trigger({
					type: "pageContentViewed"
				});
			}
		})

	});
})(jQuery);
</script>

<!--Marketo-->
<script>

    //store munchkin status to use in other functions
    var munchkinLive = false;

    //marketo munchkin
    (function() {
      var didInit = false;
      function initMunchkin() {
        if(didInit === false) {
          didInit = true;
          Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
          munchkinLive = true;
        }
      }
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.src = '//munchkin.marketo.net/munchkin.js';
      s.onreadystatechange = function() {
        if (this.readyState == 'complete' || this.readyState == 'loaded') {
          initMunchkin();
        }
      };
      s.onload = initMunchkin;
      document.getElementsByTagName('head')[0].appendChild(s);
    })();


    //wait for jquery as we use a custom jquery event, triggered by waypoint.
    (function($) {
      $(function() {
        var pageViewed = false;
        
        $(document).on("pageContentViewed", handlePageContentViewed);
        
        function handlePageContentViewed(e) {
          var viewedPagePath = "/viewed"+window.location.pathname;
          if(!pageViewed && munchkinLive){
            Munchkin.munchkinFunction('visitWebPage', {
              'url': viewedPagePath
              }
            );
            pageViewed = true;
          }
        };


      });
    })(jQuery);

</script><!--Footer Scripts Cloudstate-->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WWL9BXX');</script>
<!-- End Google Tag Manager -->
  </body>
</html>
