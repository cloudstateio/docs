<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Event sourcing · CloudState</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='CloudState Documentation'/>
<link rel="canonical" href="https://cloudstate.io/docs/user/features/eventsourced.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>

<!-- OneTrust Cookies Consent Notice start -->
<script type="text/javascript">
(function(w,d,s){if(w.location.protocol!="file:"){var f=d.getElementsByTagName(s)[0],j=d.createElement(s);
j.async=true;j.src="https://optanon.blob.core.windows.net/consent/a14b53db-7715-45da-be81-7fd0cafc385d.js";
j.charset="UTF-8";f.parentNode.insertBefore(j,f);}})(window,document,"script");</script>
<!-- OneTrust Cookies Consent Notice end -->

<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-2">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WWL9BXX');</script>
<!-- End Google Tag Manager -->

<script type="text/javascript" src="../../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../js/page.js"></script>
<script type="text/javascript" src="../../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../../css/page.css"/>

<link rel="icon" type="image/x-icon" href="../../../favicon.ico">
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../../index.html" >
<img src="../../images/cloudstate-horizontal-color.svg" alt="CloudState"/>
</a>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../../user/index.html" class="page">Using CloudState</a>
  <ul>
    <li><a href="../../user/quickstart.html" class="page">Quickstart</a></li>
    <li><a href="../../user/features/index.html" class="page">Overview</a>
    <ul>
      <li><a href="../../user/features/grpc.html" class="page">gRPC descriptors</a></li>
      <li><a href="../../user/features/eventsourced.html" class="active page">Event sourcing</a></li>
      <li><a href="../../user/features/crdts.html" class="page">Conflict-free Replicated Data Types</a></li>
      <li><a href="../../user/features/effects.html" class="page">Forwarding and effects</a></li>
    </ul></li>
    <li><a href="../../user/lang/index.html" class="page">Languages</a>
    <ul>
      <li><a href="../../user/lang/javascript/index.html" class="page">JavaScript</a></li>
      <li><a href="../../user/lang/java/index.html" class="page">Java</a></li>
      <li><a href="../../user/lang/go/index.html" class="page">Go</a></li>
    </ul></li>
    <li><a href="../../user/deployment/index.html" class="page">Deploying applications</a>
    <ul>
      <li><a href="../../user/deployment/installing.html" class="page">Installing</a></li>
      <li><a href="../../user/deployment/deploying.html" class="page">Deploying a stateful service</a></li>
      <li><a href="../../user/deployment/stores/index.html" class="page">Stateful stores</a></li>
      <li><a href="../../user/deployment/monitoring.html" class="page">Monitoring</a></li>
      <li><a href="../../user/deployment/autoscaling.html" class="page">Autoscaling</a></li>
      <li><a href="../../user/deployment/security.html" class="page">Security</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../../spec/index.html" class="page">Protocol Specification</a></li>
  <li><a href="../../developer/index.html" class="page">Content for developers of CloudState</a>
  <ul>
    <li><a href="../../developer/thebuild.html" class="page">The CloudState Build</a></li>
    <li><a href="../../developer/language-support/index.html" class="page">Language support</a>
    <ul>
      <li><a href="../../developer/language-support/serialization.html" class="page">CloudState serialization convention</a></li>
    </ul></li>
  </ul></li>
</ul>
</div>
</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../../.."><img src="../../images/cloudstate-horizontal-white.svg" alt="CloudState"/></a></div>
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column site-nav-container">
<nav class="site-nav">
<div class="nav-home">
<a href="../../index.html" >
<img src="../../images/cloudstate-horizontal-color.svg" alt="CloudState"/>
</a>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../../user/index.html" class="page">Using CloudState</a>
  <ul>
    <li><a href="../../user/quickstart.html" class="page">Quickstart</a></li>
    <li><a href="../../user/features/index.html" class="page">Overview</a>
    <ul>
      <li><a href="../../user/features/grpc.html" class="page">gRPC descriptors</a></li>
      <li><a href="../../user/features/eventsourced.html" class="active page">Event sourcing</a></li>
      <li><a href="../../user/features/crdts.html" class="page">Conflict-free Replicated Data Types</a></li>
      <li><a href="../../user/features/effects.html" class="page">Forwarding and effects</a></li>
    </ul></li>
    <li><a href="../../user/lang/index.html" class="page">Languages</a>
    <ul>
      <li><a href="../../user/lang/javascript/index.html" class="page">JavaScript</a></li>
      <li><a href="../../user/lang/java/index.html" class="page">Java</a></li>
      <li><a href="../../user/lang/go/index.html" class="page">Go</a></li>
    </ul></li>
    <li><a href="../../user/deployment/index.html" class="page">Deploying applications</a>
    <ul>
      <li><a href="../../user/deployment/installing.html" class="page">Installing</a></li>
      <li><a href="../../user/deployment/deploying.html" class="page">Deploying a stateful service</a></li>
      <li><a href="../../user/deployment/stores/index.html" class="page">Stateful stores</a></li>
      <li><a href="../../user/deployment/monitoring.html" class="page">Monitoring</a></li>
      <li><a href="../../user/deployment/autoscaling.html" class="page">Autoscaling</a></li>
      <li><a href="../../user/deployment/security.html" class="page">Security</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../../spec/index.html" class="page">Protocol Specification</a></li>
  <li><a href="../../developer/index.html" class="page">Content for developers of CloudState</a>
  <ul>
    <li><a href="../../developer/thebuild.html" class="page">The CloudState Build</a></li>
    <li><a href="../../developer/language-support/index.html" class="page">Language support</a>
    <ul>
      <li><a href="../../developer/language-support/serialization.html" class="page">CloudState serialization convention</a></li>
    </ul></li>
  </ul></li>
</ul>
</div>
</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../../index.html">CloudState</a></li>
  <li><a href="../../user/index.html">Using CloudState</a></li>
  <li><a href="../../user/features/index.html">Overview</a></li>
  <li>Event sourcing</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#event-sourcing" name="event-sourcing" class="anchor"><span class="anchor-link"></span></a>Event sourcing</h1>
<p>Event sourcing is a method of persistence that offers ACID semantics, with horizontal scaling across entities and failure isolation.</p>
<p>Rather than persisting the current state of an entity, an event sourced entity persists all of the events that led to the entity reaching its current state. These events are stored in a journal. When the current state of the entity is needed, the journal is read, and each event is replayed, to compute the current state of the entity.</p>
<p>One of the biggest advantages of event sourcing in a distributed system is that the state of the entity can be reliably replicated to other services and views. Unlike a CRUD based entity, where there&rsquo;s no inherent way to know whether a particular update has been replicated elsewhere, event sourced entities can take advantage of the fact that their events are persisted to a log, and use offset tracking in that log to track which systems have replicated which events. This is a fundamental building block necessary to implement Command Query Responsibility Segregation (CQRS), as it allows read side views to be kept up to date by consuming the event log.</p>
<p>Event sourced entities also allow temporal querying, where the state of an entity can be recreated at any point in history. This is useful both for audit purposes, as the event log can serve as an audit log, as well as for debugging purposes.</p>
<h2><a href="#consistency-guarantees" name="consistency-guarantees" class="anchor"><span class="anchor-link"></span></a>Consistency guarantees</h2>
<p>Event sourced entities offer strong consistency guarantees. Event sourced entities are sharded across every node in a stateful service deployment - at any given time, each entity will live on exactly one node. If a command arrives on a particular node for an entity that lives on a different node, that command is forwarded by the proxy to the node where the entity lives on. This forwarding is done transparently, the user function has no knowledge of it occurring.</p>
<p>Because each entity lives on exactly one node, that node can handle commands for each entity sequentially. Hence, there are no concurrency concerns relating to event sourced entities, each entity handles one command at a time.</p>
<h2><a href="#terminology" name="terminology" class="anchor"><span class="anchor-link"></span></a>Terminology</h2>
<p>CloudState uses the following terminology in relation to event sourcing:</p>
<dl>
  <dt>State</dt>
  <dd>The state is the current state on an event sourced entity instance. It is held in memory by an event sourced entity.</dd>
  <dt>Command</dt>
  <dd>A command is a message addressed to a particular entity to do something. A command comes from a sender, and a reply may be sent to the sender.</dd>
  <dt>Command handler</dt>
  <dd>A command handler is the code that handles a command. It may validate the command using the current state, and may emit new events as part of its processing. A command handler <strong>must not</strong> update the state of the entity, except by emitting new events. If a command handler does update the state, then when the entity is passivated, those updates will be lost.</dd>
  <dt>Event</dt>
  <dd>An event is a piece of data that gets persisted indicating something that happened to the entity. Events are stored in a journal, and are read and replayed each time the entity is reloaded by the state management system.</dd>
  <dt>Event handler</dt>
  <dd>An event handler is the only thing that is allowed to update the state of the entity. It receives events, and, according to the event, updates the state.</dd>
  <dt>Snapshot</dt>
  <dd>A snapshot is a snapshot of the state, persisted periodically (eg, every 100 events), as an optimization so that when the entity is reloaded from the journal, the entire journal doesn&rsquo;t need to be replayed.</dd>
  <dt>Persistence id</dt>
  <dd>The persistence id is an identifier that is prepended to each entity id when persisted. If you are sharing databases between multiple stateful services, it is important that you select unique persistence ids for each entity, so that their entity instances don&rsquo;t conflict.</dd>
</dl>
<h2><a href="#language-support" name="language-support" class="anchor"><span class="anchor-link"></span></a>Language support</h2>
<p>For detailed documentation on implementing event sourced entities in your favourite language, follow the links below:</p>
<ul>
  <li><a href="../lang/javascript/eventsourced.html">JavaScript</a></li>
  <li><a href="../lang/java/eventsourced.html">Java</a></li>
</ul>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/cloudstateio/cloudstate/tree/master/docs/src/main/paradox/user/features/eventsourced.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../../user/features/crdts.html">Conflict-free Replicated Data Types</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../../user/features/eventsourced.html#event-sourcing" class="header">Event sourcing</a>
  <ul>
    <li><a href="../../user/features/eventsourced.html#consistency-guarantees" class="header">Consistency guarantees</a></li>
    <li><a href="../../user/features/eventsourced.html#terminology" class="header">Terminology</a></li>
    <li><a href="../../user/features/eventsourced.html#language-support" class="header">Language support</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<a href="../../.."><img src="../../images/cloudstate-stacked-white.svg"></a>
<p>© CloudState 2019 | <a href="../../../privacy/">Privacy Policy</a> | <a class="optanon-toggle-display">Cookie Settings</a></p>

</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../../js/magellan.js"></script>

<style type="text/css">@import "../../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>


</html>
